<div class="card">
  <p-toast></p-toast>
  <p-confirmpopup></p-confirmpopup>

  <div class="flex justify-content-between align-items-center mb-4">
    <h2>Panel de Ventas</h2>
    <button 
      pButton 
      icon="pi pi-plus" 
      label="Nueva Venta" 
      routerLink="/sales/new"
      class="p-button-success">
    </button>
  </div>

  <!-- Estadísticas -->
  <div class="grid mb-4">
    <div class="col-12 md:col-4">
      <p-card class="stat-card">
        <div class="flex justify-content-between align-items-center">
          <div>
            <div class="text-500 font-medium">Total Ventas</div>
            <div class="text-900 font-bold text-2xl">{{ totalSales }}</div>
          </div>
          <div class="p-3 bg-blue-100 border-round">
            <i class="pi pi-shopping-cart text-blue-500 text-2xl"></i>
          </div>
        </div>
      </p-card>
    </div>
    
    <div class="col-12 md:col-4">
      <p-card class="stat-card">
        <div class="flex justify-content-between align-items-center">
          <div>
            <div class="text-500 font-medium">Ingresos Totales</div>
            <div class="text-900 font-bold text-2xl">${{ totalRevenue | number:'1.2-2' }}</div>
          </div>
          <div class="p-3 bg-green-100 border-round">
            <i class="pi pi-dollar text-green-500 text-2xl"></i>
          </div>
        </div>
      </p-card>
    </div>
    
    <div class="col-12 md:col-4">
      <p-card class="stat-card">
        <div class="flex justify-content-between align-items-center">
          <div>
            <div class="text-500 font-medium">Venta Promedio</div>
            <div class="text-900 font-bold text-2xl">${{ averageSale | number:'1.2-2' }}</div>
          </div>
          <div class="p-3 bg-purple-100 border-round">
            <i class="pi pi-chart-line text-purple-500 text-2xl"></i>
          </div>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Pestañas -->
  <p-tabs (onChange)="onTabChange($event)">
    <p-tablist header="Todas las Ventas">
      <p-table 
        [value]="sales" 
        [loading]="loading"
        [paginator]="true" 
        [rows]="10"
        [rowsPerPageOptions]="[10, 20, 50]"
        styleClass="p-datatable-striped">
        
        <ng-template pTemplate="header">
          <tr>
            <th>ID</th>
            <th>Fecha</th>
            <th>Método de Pago</th>
            <th>Total</th>
            <th>Estado</th>
            <th>Items</th>
            <th>Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-sale>
          <tr>
            <td class="font-bold">#{{ sale.id }}</td>
            <td>{{ formatDate(sale.created_at) }}</td>
            <td>
              <div class="flex align-items-center gap-2">
                <i [class]="getPaymentMethodIcon(sale.payment_method)"></i>
                <span>{{ sale.payment_method }}</span>
              </div>
            </td>
            <td class="font-bold text-green-600">${{ sale.total_amount | number:'1.2-2' }}</td>
            <td>
              <p-tag 
                [value]="sale.status" 
                (severity)="getStatusSeverity(sale.status)">
              </p-tag>
            </td>
            <td>
              <span class="font-bold">{{ sale.items.length }} items</span>
            </td>
            <td>
              <div class="flex gap-1">
                <button 
                  pButton 
                  icon="pi pi-eye" 
                  class="p-button-rounded p-button-info p-button-sm"
                  [routerLink]="['/sales', sale.id]">
                </button>
                
                <p-button 
                  icon="pi pi-cog" 
                  class="p-button-rounded p-button-warning p-button-sm"
                  (onClick)="updateSaleStatus(sale, 'completed')"
                  *ngIf="sale.status !== 'completed'">
                </p-button>

                <p-button 
                  icon="pi pi-times" 
                  class="p-button-rounded p-button-danger p-button-sm"
                  (onClick)="updateSaleStatus(sale, 'cancelled')"
                  *ngIf="sale.status !== 'cancelled'">
                </p-button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="7" class="text-center">No se encontraron ventas</td>
          </tr>
        </ng-template>
      </p-table>
    </p-tablist>

    <p-tablist header="Mis Ventas">
      <p-table 
        [value]="mySales" 
        [loading]="loading"
        [paginator]="true"
        [rows]="10">
        
        <ng-template pTemplate="header">
          <tr>
            <th>ID</th>
            <th>Fecha</th>
            <th>Total</th>
            <th>Estado</th>
            <th>Items</th>
            <th>Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-sale>
          <tr>
            <td class="font-bold">#{{ sale.id }}</td>
            <td>{{ formatDate(sale.created_at) }}</td>
            <td class="font-bold text-green-600">${{ sale.total_amount | number:'1.2-2' }}</td>
            <td>
              <p-tag 
                [value]="sale.status" 
                (severity)="getStatusSeverity(sale.status)">
              </p-tag>
            </td>
            <td>
              <span class="font-bold">{{ sale.items.length }} items</span>
            </td>
            <td>
              <button 
                pButton 
                icon="pi pi-eye" 
                class="p-button-rounded p-button-info p-button-sm"
                [routerLink]="['/sales', sale.id]">
              </button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tablist>
  </p-tabs>
</div>