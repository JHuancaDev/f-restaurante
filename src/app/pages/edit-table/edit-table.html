<!-- src/app/components/table-manager/table-manager.component.html -->
<div class="table-manager-container">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!-- Toolbar -->
  <p-toolbar styleClass="mb-4">
    <ng-template pTemplate="start">
      <h2 class="m-0">
        <i class="pi pi-th-large mr-2"></i>
        Gestión de Mesas del Restaurante
      </h2>
    </ng-template>
    
    <ng-template pTemplate="end">
      <p-button 
        icon="pi pi-plus" 
        label="Añadir Mesa"
        (onClick)="openAddDialog()"
        styleClass="p-button-success mr-2">
      </p-button>
      
      <p-button 
        icon="pi pi-trash" 
        label="Limpiar Todo"
        (onClick)="clearAll()"
        [disabled]="tables.length === 0"
        styleClass="p-button-danger">
      </p-button>
    </ng-template>
  </p-toolbar>

  <!-- Información -->
  <p-card styleClass="mb-4">
    <div class="info-section">
      <div class="info-item">
        <i class="pi pi-info-circle"></i>
        <span><strong>Total de mesas:</strong> {{ tables.length }}</span>
      </div>
      <div class="info-item">
        <i class="pi pi-users"></i>
        <span><strong>Capacidad total:</strong> {{ totalSeats }} personas</span>
      </div>
      <div class="info-item">
        <i class="pi pi-arrows-alt"></i>
        <span>Arrastra las mesas para cambiar su posición</span>
      </div>
    </div>
  </p-card>

  <!-- Área del Restaurante -->
  <div class="restaurant-area-wrapper">
    <p-card>
      <div 
        class="restaurant-area"
        (drop)="onDrop($event)"
        (dragover)="onDragOver($event)">
        
        <!-- Mensaje cuando no hay mesas -->
        <div *ngIf="tables.length === 0" class="empty-state">
          <i class="pi pi-inbox"></i>
          <p>No hay mesas en el restaurante</p>
          <p-button 
            label="Añadir Primera Mesa" 
            icon="pi pi-plus"
            (onClick)="openAddDialog()">
          </p-button>
        </div>

        <!-- Mesas -->
        <div 
          *ngFor="let table of tables"
          class="table-item"
          [class.selected]="selectedTable?.id === table.id"
          [ngStyle]="getTableStyle(table)"
          draggable="true"
          (dragstart)="onDragStart($event, table)"
          (dragend)="onDragEnd($event)"
          (click)="selectTable(table)">
          
          <div class="table-content">
            <div class="table-number">Mesa {{ table.number }}</div>
            <div class="table-seats">
              <i class="pi pi-users"></i> {{ table.seats }}
            </div>
          </div>

          <div class="table-actions">
            <button 
              pButton 
              icon="pi pi-trash" 
              class="p-button-rounded p-button-danger p-button-sm"
              (click)="deleteTable(table); $event.stopPropagation()"
              pTooltip="Eliminar mesa"
              tooltipPosition="top">
            </button>
          </div>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Panel de Detalles (cuando se selecciona una mesa) -->
  <div *ngIf="selectedTable" class="details-panel">
    <p-card>
      <ng-template pTemplate="header">
        <div class="details-header">
          <h3>
            <i class="pi pi-cog mr-2"></i>
            Mesa {{ selectedTable.number }}
          </h3>
          <button 
            pButton 
            icon="pi pi-times" 
            class="p-button-rounded p-button-text"
            (click)="selectedTable = null">
          </button>
        </div>
      </ng-template>

      <div class="details-content">
        <div class="detail-item">
          <label>Número de Sillas:</label>
          <p-inputNumber 
            [(ngModel)]="selectedTable.seats"
            [min]="1" 
            [max]="20"
            [showButtons]="true"
            buttonLayout="horizontal"
            (onInput)="updateTableSeats(selectedTable, selectedTable.seats)"
            inputId="seats">
          </p-inputNumber>
        </div>

        <div class="detail-item">
          <label>Forma:</label>
          <span class="shape-badge">
            {{ selectedTable.shape === 'rectangle' ? 'Rectangular' : 'Circular' }}
          </span>
        </div>

        <div class="detail-item">
          <label>Posición:</label>
          <span>X: {{ selectedTable.x | number:'1.0-0' }}px, Y: {{ selectedTable.y | number:'1.0-0' }}px</span>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Dialog para Añadir Mesa -->
  <p-dialog 
    header="Añadir Nueva Mesa" 
    [(visible)]="showAddDialog"
    [modal]="true"
    [style]="{width: '450px'}"
    [draggable]="false"
    [resizable]="false">
    
    <div class="dialog-content">
      <div class="field">
        <label for="seats">Número de Sillas</label>
        <p-inputNumber 
          [(ngModel)]="newTableSeats"
          [min]="1" 
          [max]="20"
          [showButtons]="true"
          buttonLayout="horizontal"
          inputId="seats"
          styleClass="w-full">
        </p-inputNumber>
      </div>

      <div class="field">
        <label for="shape">Forma de la Mesa</label>
        <p-dropdown 
          [(ngModel)]="newTableShape"
        
          optionLabel="label"
          optionValue="value"
          inputId="shape"
          styleClass="w-full">
        </p-dropdown>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button 
        label="Cancelar" 
        icon="pi pi-times"
        (onClick)="showAddDialog = false"
        styleClass="p-button-text">
      </p-button>
      <p-button 
        label="Añadir" 
        icon="pi pi-check"
        (onClick)="addTable()">
      </p-button>
    </ng-template>
  </p-dialog>
</div>